<html>
	<head>
		<title>Tempmon</title>
	</head>
	
	<body>
		<div>
			<div>
				<canvas id="theCanvas" width="320" height="200" style="border:1px solid #000000;" tabindex="0">
					Your browser does not support the HTML5 canvas tag.
				</canvas>

				<div id="theDiv">...</div>
			</div>
		</div>
	</body>
	
	<script>
		function makeHttpRequestPromise( url, method, data, headers )
		{
			var promise = new Promise(
				function(resolve, reject) 
				{
					var request = new XMLHttpRequest();
					request.open( method, url );
					if ( headers )
					{
						for ( var header in headers )
						{
							if ( headers.hasOwnProperty(header) )
							{
								request.setRequestHeader(header, headers[header]);
							}
						}
					}

					request.onload = function( event ) 	 
						{
							if ( request.status===200 )
							{
								resolve( request.response );
							}
							else
							{
								reject( new Error(request.status ) );
							}
						};

					request.onerror = function( event )		
						{
							reject( new Error(request.status ) );
						};
			
					try
					{
						request.send(data);
					}
					catch (exception)
					{
						reject( exception );
					}
				});
			return promise;
		}

		var canvas = document.getElementById('theCanvas');
		var ctx = canvas.getContext("2d");
		ctx.moveTo(0,0);
		ctx.lineTo(200,100);
		ctx.stroke();

		var div = document.getElementById('theDiv');
		div.innerHTML = 'toto';

		makeHttpRequestPromise( '/api/devices/1D80C/messages', 'GET')
			.then(
				function( response )
				{
					var messages = JSON.parse(response);
					div.innerHTML = messages.data.length;
					for ( var i=0; i<messages.data.length; ++i  )
					{
						var message = messages.data[i];
						var numSecondsSinceEpoch = message.time;
						var date = new Date( numSecondsSinceEpoch * 1000 );
						div.innerHTML += "<div>" + date.toString() + ": " + message.data + "</div>";
					}

					
				})
			.catch(
				function( error )
				{
					div.innerHTML = error.toString();
				});
	</script>
	
</html>
